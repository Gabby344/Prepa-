<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pr√©pa+ ‚Äî R√©vise avec clart√©</title>

  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Open+Sans&display=swap" rel="stylesheet" />

  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: 'Open Sans', sans-serif;
      background: linear-gradient(to right, #eef2f3, #dbe4ea);
      color: #2c3e50;
      margin: 0;
      padding: 20px;
      text-align: center;
      animation: fadeIn 1.5s ease forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .logo {
      font-family: 'Playfair Display', serif;
      font-size: 2.8em;
      margin-top: 20px;
      color: #2c3e50;
      letter-spacing: 1px;
    }

    .slogan {
      font-style: italic;
      font-size: 1.1em;
      margin-bottom: 30px;
      color: #555;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .grid button {
      padding: 15px;
      font-size: 1em;
      background-color: #2c3e50;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      /* Ic√¥nes pour les boutons (inspir√© de l'image) */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .grid button:before {
        margin-right: 8px;
        font-weight: bold;
    }
    .grid button:nth-child(1):before { content: 'üìö'; }
    .grid button:nth-child(2):before { content: 'üìÑ'; }
    .grid button:nth-child(3):before { content: 'üèÜ'; }
    .grid button:nth-child(4):before { content: 'üß†'; }

    .grid button:hover {
      background-color: #1a252f;
      transform: scale(1.05);
    }

    .progress {
      margin: 20px auto;
      width: 80%;
      background-color: #ccc;
      border-radius: 20px;
      overflow: hidden;
    }

    .progress-bar {
      height: 20px;
      width: 12%;
      background-color: #25D366;
      transition: width 1s ease;
    }

    .quote {
      margin-top: 30px;
      font-style: italic;
      color: #666;
      font-size: 1em;
    }

    .page {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px;
      margin: 10px auto;
      width: 90%;
      text-align: left;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      animation: fadeIn 0.8s ease;
    }

    .page h3 {
      margin-bottom: 10px;
      font-size: 1.1em;
    }

    .page button {
      display: block;
      margin: 5px 0;
      padding: 10px;
      width: 100%;
      background-color: #2c3e50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease, transform 0.1s ease;
    }

    .page button:hover {
      background-color: #1a252f;
    }

    /* NOUVEAUX STYLES POUR LE FEEDBACK VISUEL */
    .page button:disabled {
        opacity: 0.6;
        cursor: default;
        transition: none; /* Emp√™che les transitions sur l'opacit√© */
    }
    
    .explication {
      margin-top: 15px;
      padding: 10px;
      border-radius: 5px;
      line-height: 1.4;
      font-size: 0.95em;
      background-color: #f4f6f8;
      color: #2c3e50;
      text-align: left;
      border-left: 5px solid #2c3e50; /* Style √©l√©gant */
    }
    
    .explication strong {
        font-weight: bold;
        color: #1a252f;
    }


    .admin-link {
      margin-top: 30px;
    }

    .admin-link a {
      text-decoration: none;
    }

    .admin-link button {
      padding: 10px 20px;
      background-color: #888;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 0.9em;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .admin-link button:hover {
      background-color: #555;
    }

    footer {
      margin-top: 40px;
      font-size: 0.9em;
      color: #777;
    }
  </style>
</head>
<body>

  <div class="logo">üìò Pr√©pa+</div>
  <div class="slogan">R√©vise avec clart√©. Progresse avec fiert√©.</div>

  <div class="grid">
    <button onclick="chargerQuiz()">Quiz</button>
    <button onclick="alert('Fiches √† venir')">Fiches</button>
    <button onclick="alert('D√©fis √† venir')">D√©fis</button>
    <button onclick="alert('Coaching IA √† venir')">Coaching IA</button>
  </div>

  <div class="progress">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  <p>Tu as r√©vis√© <strong id="progressText">12%</strong> cette semaine</p>

  <div class="quote">‚ÄúTon avenir m√©rite ton attention aujourd‚Äôhui.‚Äù</div>

  <div id="quizContainer"></div>

  <div class="admin-link">
    <a href="admin.html"><button>üîê Acc√®s Admin</button></a>
  </div>

  <footer>Con√ßu avec passion par <strong>Gabby Umba ‚Äî ISC Lwanga</strong></footer>

  <script>
    // ‚ö†Ô∏è IMPORTANT: Votre cl√© est expos√©e ici. Pensez √† s√©curiser vos r√®gles Firestore !
    const firebaseConfig = {
      apiKey: "AIzaSyAuHPWVOkd96xPqKQ_K1cC4n4ihuPfuNFQ",
      authDomain: "abiga-1718.firebaseapp.com",
      projectId: "abiga-1718",
      storageBucket: "abiga-1718.appspot.com",
      messagingSenderId: "103455679291",
      appId: "1:103455679291:web:eda13441fedfce226d4d1e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    window.onload = () => {
      document.getElementById("progressBar").style.width = "12%";
      document.getElementById("progressText").textContent = "12%";
    };

    let essais = {}; // Compteur d'essais pour chaque question

    /**
     * V√©rifie la r√©ponse du quiz et fournit un feedback visuel.
     * @param {HTMLElement} element - Le bouton sur lequel l'utilisateur a cliqu√©.
     * @param {string} reponse - La r√©ponse s√©lectionn√©e.
     * @param {string} bonneReponse - La bonne r√©ponse attendue.
     * @param {string} explication - L'explication √† afficher.
     * @param {string} questionId - L'ID unique de la question.
     */
    function verifierReponse(element, reponse, bonneReponse, explication, questionId) {
        if (!essais[questionId]) essais[questionId] = 0;
        essais[questionId]++;

        const parentDiv = element.closest('.page');
        const optionsButtons = parentDiv.querySelectorAll('button');
        let explicationDiv = parentDiv.querySelector('.explication');

        // Cr√©er la zone d'explication si elle n'existe pas
        if (!explicationDiv) {
            explicationDiv = document.createElement('div');
            explicationDiv.className = 'explication';
            parentDiv.appendChild(explicationDiv);
        }

        explicationDiv.style.display = 'block'; // S'assurer que la zone est visible
        explicationDiv.style.backgroundColor = '#f4f6f8'; // Couleur par d√©faut

        // D√©sactiver TOUS les boutons imm√©diatement pour √©viter de tricher apr√®s un essai
        optionsButtons.forEach(btn => btn.disabled = true);
        
        // Si la r√©ponse est correcte
        if (reponse === bonneReponse) {
            element.style.backgroundColor = '#25D366'; // Vert
            element.style.boxShadow = '0 0 10px rgba(37, 211, 102, 0.5)';
            explicationDiv.style.borderLeftColor = '#25D366';
            
            explicationDiv.innerHTML = `‚úÖ **Bonne r√©ponse !**<br> ${explication}`;
            
            // Logique de progression √† ajouter ici plus tard
            // updateProgress(1); 
            
            essais[questionId] = 0; // Marquer comme r√©ussi
        } 
        // Si la r√©ponse est incorrecte
        else {
            element.style.backgroundColor = '#E57373'; // Rouge
            
            // Si c'est le dernier essai (apr√®s 3 tentatives, on donne la r√©ponse)
            if (essais[questionId] >= 3) {
                // Montrer la bonne r√©ponse en vert
                optionsButtons.forEach(btn => {
                    if (btn.textContent.trim() === bonneReponse.trim()) {
                        btn.style.backgroundColor = '#25D366';
                        btn.style.opacity = 1; // Rendre plus visible
                    }
                });
                
                explicationDiv.style.borderLeftColor = '#E57373';
                explicationDiv.innerHTML = `‚ùå **Fin des essais.**<br>La bonne r√©ponse √©tait : **${bonneReponse}**.<br>üìò Explication : ${explication}`;
                essais[questionId] = 0; // R√©initialiser
                
            } else {
                // Tentative incorrecte - permettre d'essayer une autre option
                optionsButtons.forEach(btn => btn.disabled = false); // R√©activer TOUS les boutons
                element.disabled = true; // D√©sactiver l'option s√©lectionn√©e seulement
                
                explicationDiv.style.borderLeftColor = '#E57373';
                explicationDiv.innerHTML = `‚ùå Mauvaise r√©ponse. Essaie encore (Tentative ${essais[questionId]} / 3)`;
            }
        }
    }

    /**
     * Charge les questions du quiz depuis Firebase et les affiche.
     */
    async function chargerQuiz() {
      const container = document.getElementById("quizContainer");
      container.innerHTML = "Chargement des questions...";

      try {
        const snapshot = await db.collection("quizzes").get();
        container.innerHTML = ""; // Vider apr√®s chargement

        if (snapshot.empty) {
             container.innerHTML = "Aucune question de quiz trouv√©e dans la base de donn√©es.";
             return;
        }

        const questionsD√©j√†Affich√©es = new Set();
        
        snapshot.forEach(doc => {
          const data = doc.data();
          const id = doc.id;

          // Simple v√©rification pour √©viter d'afficher le m√™me contenu si plusieurs docs ont la m√™me question
          if (questionsD√©j√†Affich√©es.has(data.question)) return;
          questionsD√©j√†Affich√©es.add(data.question);

          // On g√®re les apostrophes dans la cha√Æne de caract√®res pass√©e √† la fonction JS
          const safeExplication = data.explication ? data.explication.replace(/'/g, "\\'") : '';

          const div = document.createElement('div');
          div.className = 'page';
          div.innerHTML = `
            <h3>${data.question}</h3>
            ${data.options.map(opt => `
              <button onclick="verifierReponse(this, '${opt.replace(/'/g, "\\'")}', '${data.bonneReponse.replace(/'/g, "\\'")}', \`${safeExplication}\`, '${id}')">${opt}</button>
            `).join('')}
            `;
          container.appendChild(div);
        });

      } catch (error) {
        console.error("Erreur lors du chargement des quizzes : ", error);
        container.innerHTML = "Erreur de connexion √† la base de donn√©es.";
      }
    }
  </script>
</body>
</html>
